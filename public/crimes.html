<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crimes | Empire of Silence</title>
  <link rel="stylesheet" href="style.css">
  <script src="common.js"></script>
  <style>
    .crime-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .crime-card {
      background: #2c2c2c;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: transform 0.2s, background 0.2s;
      cursor: pointer;
      font-weight: bold;
    }
    .crime-card:hover {
      background: #383838;
      transform: scale(1.02);
    }
    .crime-card.locked {
      background: #1a1a1a;
      color: #777;
      border: 1px solid #333;
      cursor: not-allowed;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
      display: none;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Empire</h2>
    <a href="/">üè† Home</a>
    <a href="/crimes">üíÄ Crimes</a>
    <a href="/jobs">üìú Jobs</a>
    <a href="/prison">‚õì Prison</a>
    <a href="/login" onclick="logout()">üö™ Logout</a>
    <a href="/admin">‚öñ Admin</a>
  </div>

  <div class="content">
    <h1>Crimes</h1>
    <p>Select a crime to commit. Locked crimes show their required rank.</p>

    <div class="crime-list" id="crimeList"></div>

    <div id="result"></div>
  </div>

  <script>
    const crimes = [
      { id: "pickpocket", name: "Pickpocket", rank: "Street Rat" },
      { id: "shoplift", name: "Shoplifting", rank: "Errand Boy" },
      { id: "vandalism", name: "Vandalism", rank: "Associate" },
      { id: "car_theft", name: "Car Theft", rank: "Muscle" },
      { id: "smuggling", name: "Smuggling", rank: "Enforcer" },
      { id: "kidnap", name: "Kidnap", rank: "Caporegime" },
      { id: "blackmail", name: "Blackmail", rank: "Caporegime" },
      { id: "drug_deal", name: "Drug Dealing", rank: "Underboss" },
      { id: "hijack_truck", name: "Hijack Truck", rank: "Underboss" },
      { id: "rob_bank", name: "Rob Bank", rank: "Consigliere" },
      { id: "arms_deal", name: "Arms Deal", rank: "Consigliere" },
      { id: "political_hit", name: "Political Hit", rank: "Boss" },
      { id: "legendary_heist", name: "Legendary Heist", rank: "Godfather" }
    ];

    async function loadCrimes() {
      const player = await apiGet("/players/me");
      const rankOrder = [
        "Street Rat","Errand Boy","Associate","Muscle",
        "Enforcer","Caporegime","Underboss","Consigliere",
        "Boss","Godfather"
      ];
      const playerRankIndex = rankOrder.indexOf(player.rank);

      const list = document.getElementById("crimeList");
      list.innerHTML = "";

      crimes.forEach(c => {
        const card = document.createElement("div");
        card.className = "crime-card";
        card.innerText = `${c.name}`;

        const requiredIndex = rankOrder.indexOf(c.rank);
        if (playerRankIndex < requiredIndex) {
          card.classList.add("locked");
          card.innerText = `${c.name} (${c.rank}+)`;
        } else {
          card.onclick = () => doCrime(c.id);
        }
        list.appendChild(card);
      });
    }

    async function doCrime(type) {
      const resultBox = document.getElementById("result");
      resultBox.style.display = "block";
      resultBox.innerText = "Processing...";
      resultBox.className = "";

      try {
        const res = await apiPost("/crimes", { type });
        let msg = res.message;

        // Style messages based on content
        if (msg.includes("Success")) {
          resultBox.className = "crime-success";
        } else if (msg.includes("Failed")) {
          resultBox.className = "crime-fail";
        } else if (msg.includes("ranked")) {
          resultBox.className = "crime-rankup";
        } else if (msg.includes("Prestiged")) {
          resultBox.className = "crime-prestige";
        } else {
          resultBox.className = "crime-info";
        }

        resultBox.innerText = msg;
      } catch (err) {
        resultBox.style.display = "block";
        resultBox.className = "crime-fail";
        resultBox.innerText = err.error || "Error performing crime";
      }
    }

    loadCrimes();
  </script>
</body>
</html>
