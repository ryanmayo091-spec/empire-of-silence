<!DOCTYPE html>
<html>
<head>
  <title>Empire of Silence - Crimes</title>
  <link rel="stylesheet" href="style.css">
  <script src="common.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="sidebar">
    <h2>Empire 🕶️</h2>
    <a href="/">🏠 Home</a>
    <a href="/crimes">💀 Crimes</a>
    <a href="/jobs">📜 Jobs</a>
    <a href="/login">🔑 Login</a>
    <a href="/register">📝 Register</a>
    <a id="adminLink" href="/admin" style="display:none;">👑 Admin</a>
  </div>

  <div class="content">
    <h1>Crimes</h1>
    <div class="panel">
      <p>Select a crime to commit. Beware: failures may land you in prison! ⛓️</p>
      <button id="btn-hit" onclick="doCrime('hit')">💀 Hit (High Risk)</button>
      <button id="btn-smuggling" onclick="doCrime('smuggling')">🚛 Smuggling (Medium Risk)</button>
      <button id="btn-bribe" onclick="doCrime('bribe')">💵 Bribe (Low Risk)</button>
    </div>
    <div class="panel" id="result"></div>
  </div>

  <script>
    const cooldowns = {
      hit: 0,
      smuggling: 0,
      bribe: 0
    };

    function updateCooldowns() {
      const now = Date.now();

      for (let crime in cooldowns) {
        if (cooldowns[crime] > now) {
          const secs = Math.ceil((cooldowns[crime] - now) / 1000);
          document.getElementById(`btn-${crime}`).innerText = `${crime} (${secs}s)`;
          document.getElementById(`btn-${crime}`).disabled = true;
        } else {
          if (crime === "hit") document.getElementById("btn-hit").innerText = "💀 Hit (High Risk)";
          if (crime === "smuggling") document.getElementById("btn-smuggling").innerText = "🚛 Smuggling (Medium Risk)";
          if (crime === "bribe") document.getElementById("btn-bribe").innerText = "💵 Bribe (Low Risk)";
          document.getElementById(`btn-${crime}`).disabled = false;
        }
      }
    }

    setInterval(updateCooldowns, 1000);

    async function doCrime(type) {
      if (!token) return alert("Login first");

      const res = await apiPost("/crimes", { type });
      if (res.error) {
        document.getElementById("result").innerHTML = `<p style="color:red">${res.error}</p>`;
      } else {
        document.getElementById("result").innerHTML = `<p>${res.message}</p>`;

        // Example cooldowns: hit=10s, smuggling=15s, bribe=5s
        const cdTimes = { hit: 10000, smuggling: 15000, bribe: 5000 };
        cooldowns[type] = Date.now() + cdTimes[type];
      }
    }

    // Show admin link if role is admin
    if (role === "admin" || role === "mod") {
      document.getElementById("adminLink").style.display = "block";
    }
  </script>
</body>
</html>
